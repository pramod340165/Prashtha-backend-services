spring:
  cloud:
      gateway:
        routes:
          - id: Authorization-Service
            uri: lb://Authorization-Service
            predicates:
              - Path=/api/v1/auth/register, /api/v1/auth/login, /api/v1/auth/validate-token, /api/v1/auth/refresh-token
    
          - id: user-service
            uri: lb://USER-SERVICE
            predicates:
              - Path=/api/v1/users/**
            filters:
              - name: CircuitBreaker
                args:
                  name: userServiceBreaker
                  fallbackUri: forward:/fallback/users
              - name: JwtAuthenticationFilter
    
          - id: order-service
            uri: lb://ORDER-SERVICE
            predicates:
              - Path=/api/v1/orders/**
            filters:
              - name: JwtAuthenticationFilter

resilience4j:
  circuitbreaker:
    instances:
      authCircuitBreaker:
        registerHealthIndicator: true
        slidingWindowSize: 5
        minimumNumberOfCalls: 10
        permittedNumberOfCallsInHalfOpenState: 10
        automaticTransitionFromOpenToHalfOpenEnabled: true
        waitDurationInOpenState: 5000
        failureRateThreshold: 50
        eventConsumerBufferSize: 10
        record-exceptions:
          - java.util.concurrent.TimeoutException
          - org.springframework.cloud.gateway.support.NotFoundException
          - io.github.resilience4j.circuitbreaker.CallNotPermittedException
